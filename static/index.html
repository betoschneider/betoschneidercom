<!doctype html>
<html lang="pt-BR">

<head>
  <meta charset="utf-8" />
  <title>Meus Projetos</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
  <div class="container">
    <h1>Meus Projetos</h1>
    <div id="projects">
      <p style="text-align: center; color: #6c757d;">Carregando projetos...</p>
    </div>
    <a href="/admin" class="nav-link">Gerenciar Projetos (Admin)</a>
    <footer>
      Desenvolvido por <a href="https://www.linkedin.com/in/robertoschneider/" target="_blank">Roberto Schneider</a>.
      2025. | <a href="https://github.com/betoschneider" target="_blank">GitHub</a>
    </footer>
  </div>

  <script src="/static/js/app.js"></script>
  <script>
    // Override renderPublic to use new classes
    const originalRenderPublic = renderPublic;
    renderPublic = function (projects) {
      const root = document.getElementById('projects');
      if (!projects || projects.length === 0) {
        root.innerHTML = '<p style="text-align: center;">Nenhum projeto encontrado.</p>';
        return;
      }
      root.innerHTML = projects.map(p => `
        <div class="project-card" style="cursor: default;">
          <a href="${p.url}" target="_blank" style="text-decoration: none; color: inherit; display: block;">
            <span class="project-title">${escapeHtml(p.title)}</span>
            <p class="project-desc">${escapeHtml(p.description || '')}</p>
          </a>
          ${p.repo_url ? `<div style="margin-top: 10px; font-size: 0.9em;"><a href="${p.repo_url}" target="_blank" style="color: var(--primary-color); font-weight: 500;">[CÃ³digo Fonte]</a></div>` : ''}
        </div>
      `).join('');
    };

    // render public list
    (async function () {
      const projects = await fetchProjects();
      renderPublic(projects);

      // Track visit (only once per session)
      if (!sessionStorage.getItem('visit_tracked')) {
        try {
          await fetch('/visit', { method: 'POST' });
          sessionStorage.setItem('visit_tracked', 'true');
          console.log('Visit tracked');
        } catch (e) {
          console.error('Tracking error', e);
        }
      } else {
        console.log('Visit already tracked in this session');
      }
    })();
  </script>
</body>

</html>